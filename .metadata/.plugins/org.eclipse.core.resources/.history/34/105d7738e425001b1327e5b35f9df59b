import java.rmi.Remote;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.rmi.server.UnicastRemoteObject;
import java.util.Scanner;

import es.uned.sisdist.common.ServicioAutenticacionInterface;
import es.uned.sisdist.common.ServicioDiscoClienteInterface;
import es.uned.sisdist.common.ServicioGestorInterface;

public class Cliente {
	private static ServicioAutenticacionInterface servicio_autenticacion;
	private static ServicioGestorInterface servicio_gestor; 
	
	public static void main(String[] args) throws Exception {
		Registry registry =  LocateRegistry.getRegistry(7777);
		int opcion = -1;
		String nombre = "";
		Scanner in = new Scanner(System.in);
		
		ServicioDiscoClienteInterface sdc = new ServicioDiscoClienteImpl();
		Remote sdc_remoto = UnicastRemoteObject.exportObject(sdc, 3434);
		registry.rebind("sdc_remoto", sdc_remoto);
		
		servicio_autenticacion = (ServicioAutenticacionInterface) registry.lookup("autenticacion_remota");
		servicio_gestor = (ServicioGestorInterface) registry.lookup("sg_remoto");
		
		while(opcion < 3) {
			switch(args[0]) {
				case "cliente":
					System.out.println("Elige la opci贸n de autenticacion");
					System.out.println("1. Registrar usuario");
					System.out.println("2. Iniciar sesion usuario");
					System.out.println("3. Exit");
					opcion = in.nextInt();
					in.nextLine();
					switch(opcion) {
						case 1:
							System.out.println("Indique el nombre del usuario");
							nombre = in.nextLine();					
							servicio_autenticacion.registrarObjeto(nombre, 0);
							break;
						case 2: 
							System.out.println("Indique el nombre del usuario");
							nombre = in.nextLine();					
							servicio_autenticacion.iniciarSesion(nombre, 0);
							break;
						case 3:
							break;
					}
					break;
					case "repositorio":
						System.out.println("Elige la opci贸n de autenticacion");
						System.out.println("1. Registrar repositorio");
						System.out.println("2. Iniciar sesion repositorio");
						System.out.println("3. Exit");
						opcion = in.nextInt();
						in.nextLine();
						switch(opcion) {
							case 1:
								System.out.println("Indique el nombre del repositorio");
								nombre = in.nextLine();					
								servicio_autenticacion.registrarObjeto(nombre, 1);
								break;
							case 2: 
								System.out.println("Indique el nombre del repositorio");
								nombre = in.nextLine();					
								servicio_autenticacion.iniciarSesion(nombre, 1);
								break;
							case 3:
								break;
						}
						break;
				}
				if(args[0].equals("cliente") && opcion == 2 && servicio_autenticacion.comprobarCliente(nombre)) {
					while(opcion != 6 || opcion != 7) {
						System.out.println("Elige la opci贸n de gesti贸n de archivos que considere");
						System.out.println("1. Subir Archivo");
						System.out.println("2. Bajar Archivo");
						System.out.println("3. Compartir Fichero");
						System.out.println("4. Listar tus ficheros");
						System.out.println("5. Listar clientes del sistema");
						System.out.println("6. Cerrar Sesion");
						System.out.println("7. Eliminar perfil");
						opcion = in.nextInt();
						in.nextLine();
						String path = null;
						String nombre_fichero = null;
						switch(opcion) {
						case 1:
							//Subir fihchero en path indicado.
							System.out.println("Indique el path del archivo");
							path = in.nextLine();
							System.out.println("Indique el nombre del archivo");
							nombre_fichero = in.nextLine();
							servicio_gestor.subirArchivo(path, nombre_fichero, nombre_cliente);
							
							break;
						case 2: 
							System.out.println("Indique el nombre del archivo");
							nombre_fichero = in.nextLine();
							System.out.println("Indique el path local donde bajar el archivo");
							path = in.nextLine();					
							servicio_gestor.bajarFichero(nombre, nombre_fichero, path);
							break;
						case 6:
							servicio_autenticacion.cerrarSesion(nombre, 0);
							opcion = 6;
							break;
						}
					}
				}
					
			}
			
		}
	}
